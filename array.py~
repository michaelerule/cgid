from cgid.lfp import get_filtered_lfp,get_all_analytic_lfp
from cgid.tools import pack_array_data_interpolate

def get_analytic_frames(session,area,trial,epoch=None,fa=10,fb=45):
    '''
    Scripts to pack data into frames are in the visualze file.
    I've moved them to cgidtools.
    packArrayDataInterpolate(session,area,data)
    accept NChannel x Ntimes and returns frame-packed data w. interp'd electrodes
    elaborate on this, 
    '''
    if epoch is None: epoch = 6,-1000,6000
    lfp = get_all_analytic_lfp(session,area,trial,epoch,fa,fb,onlygood=False)
    return pack_array_data_interpolate(session,area,lfp)

def data_count_critical(session,area,trial,epoch,fa,fb,upsample=3,cut=True,cutoff=1.8):
    frames = get_analytic_frames(session,area,trial,epoch,fa,fb)
    return array_count_critical(frames,upsample,cut,cutoff)

def data_count_clockwise(session,area,trial,epoch,fa,fb,upsample=3,cut=True,cutoff=1.8,fsmooth=5):
    res= data_count_critical(session,area,trial,epoch,fa,fb,upsample,cut,cutoff)[0]
    return bandfilter(res,fb=fsmooth)

def data_count_widersyns(session,area,trial,epoch,fa,fb,upsample=3,cut=True,cutoff=1.8,fsmooth=5):
    res= data_count_critical(session,area,trial,epoch,fa,fb,upsample,cut,cutoff)[1]
    return bandfilter(res,fb=fsmooth)

def data_count_singular(session,area,trial,epoch,fa,fb,upsample=3,cut=True,cutoff=1.8,fsmooth=5):
    res= data_count_critical(session,area,trial,epoch,fa,fb,upsample,cut,cutoff)
    res = res[0]+res[1]
    return bandfilter(res,fb=fsmooth)

def data_count_winding(session,area,trial,epoch,fa,fb,upsample=3,cut=True,cutoff=1.8,fsmooth=5):
    res= data_count_critical(session,area,trial,epoch,fa,fb,upsample,cut,cutoff)
    res = res[0]-res[1]
    return bandfilter(res,fb=fsmooth)

def data_count_saddles(session,area,trial,epoch,fa,fb,upsample=3,cut=True,cutoff=1.8,fsmooth=5):
    res= data_count_critical(session,area,trial,epoch,fa,fb,upsample,cut,cutoff)[2]
    return bandfilter(res,fb=fsmooth)

def data_count_maxima(session,area,trial,epoch,fa,fb,upsample=3,cut=True,cutoff=1.8,fsmooth=5):
    res= data_count_critical(session,area,trial,epoch,fa,fb,upsample,cut,cutoff)[3]
    return bandfilter(res,fb=fsmooth)

def data_count_minima(session,area,trial,epoch,fa,fb,upsample=3,cut=True,cutoff=1.8,fsmooth=5):
    res= data_count_critical(session,area,trial,epoch,fa,fb,upsample,cut,cutoff)[4]
    return bandfilter(res,fb=fsmooth)

def data_count_extrema(session,area,trial,epoch,fa,fb,upsample=3,cut=True,cutoff=1.8,fsmooth=5):
    res= data_count_critical(session,area,trial,epoch,fa,fb,upsample,cut,cutoff)
    res = res[3]+res[4]
    return bandfilter(res,fb=fsmooth)

def data_count_inflection(session,area,trial,epoch,fa,fb,upsample=3,cut=True,cutoff=1.8,fsmooth=5):
    res= data_count_critical(session,area,trial,epoch,fa,fb,upsample,cut,cutoff)
    res = res[3]+res[4]+res[2]
    return bandfilter(res,fb=fsmooth)

def data_count_critical_combine(session,area,trial,epoch,fa,fb,upsample=3,cut=True,cutoff=1.8,fsmooth=5):
    res = data_count_critical(session,area,trial,epoch,fa,fb,upsample,cut,cutoff)
    res = sum(arr(res),0)
    return bandfilter(res,fb=fsmooth)
